<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Focusing on security of AI, and distributed AI."><title>文件上传 | realyee's blog</title><link rel="stylesheet" type="text/css" href="/blog/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/blog/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/blog/favicon.ico"><link rel="apple-touch-icon" href="/blog/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/blog/apple-touch-icon.png"><script src="https://www.googletagmanager.com/gtag/js?id=G-HT3KXNPC43" async></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-HT3KXNPC43');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement('script');
  hm.src = 'https://hm.baidu.com/hm.js?' + '81692a5a3ea48096c98733a7d4bfef6b';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><div class="darkmode-toggle">🌓</div><script>var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
var toggle = document.querySelector('.darkmode-toggle');
var html = document.querySelector('html');

html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

toggle.addEventListener('click', () => {
localStorage.dark = !(html.dataset.dark == 'true');
html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">文件上传</h1><a id="logo" href="/blog/.">realyee's blog</a><p class="description">Security and privacy of AI, and distributed AI, Cybersecurity</p></div><div id="nav-menu"><a class="current" href="/blog/."><i class="fa fa-home"> Home</i></a><a href="/blog/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/blog/tags/"><i class="fa fa-tag"> Tags</i></a><a href="/blog/history/"><i class="fa fa-book"> History</i></a><a href="/blog/cheatsheet/"><i class="fa fa-user"> Cheatsheet</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">文件上传</h1><div class="post-meta">2019-08-25<span> | </span><span class="category"><a href="/blog/categories/websec/">websec</a><a href="/blog/categories/websec/file-upload/">file_upload</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 4.3k</span><span class="post-meta-item-text"> Words</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 15</span><span class="post-meta-item-text"> Minutes</span></span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">Contents</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">预备知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E7%8E%B0%E5%8F%8A%E5%88%A9%E7%94%A8"><span class="toc-number">1.1.</span> <span class="toc-text">发现及利用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%B1%E5%AE%B3"><span class="toc-number">1.2.</span> <span class="toc-text">危害</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E6%89%8B%E6%AE%B5"><span class="toc-number">1.3.</span> <span class="toc-text">过滤手段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E6%9C%A8%E9%A9%AC%E6%98%AF%E5%90%A6%E8%A7%A3%E6%9E%90"><span class="toc-number">1.4.</span> <span class="toc-text">判断木马是否解析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF-javascript-%E9%99%90%E5%88%B6"><span class="toc-number">2.</span> <span class="toc-text">前端 Javascript 限制</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-mime_types-%E7%99%BD%E5%90%8D%E5%8D%95"><span class="toc-number">3.</span> <span class="toc-text">后端 MIME_types 白名单</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E5%90%8E%E7%BC%80%E5%90%8D%E9%BB%91%E5%90%8D%E5%8D%95"><span class="toc-number">4.</span> <span class="toc-text">后端后缀名黑名单</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%BB%91%E5%90%8D%E5%8D%95%E4%B8%8D%E5%85%A8"><span class="toc-number">4.1.</span> <span class="toc-text">黑名单不全</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%89%B9%E6%80%A7"><span class="toc-number">4.2.</span> <span class="toc-text">操作系统特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E5%86%99%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90%E8%A7%84%E5%88%99"><span class="toc-number">4.3.</span> <span class="toc-text">重写文件解析规则</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E7%89%B9%E6%80%A7"><span class="toc-number">5.</span> <span class="toc-text">脚本语言函数特性</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%AD%E9%97%B4%E4%BB%B6%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E"><span class="toc-number">6.</span> <span class="toc-text">中间件解析漏洞</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E9%A9%AC"><span class="toc-number">7.</span> <span class="toc-text">图片马</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E5%87%BD%E6%95%B0"><span class="toc-number">7.1.</span> <span class="toc-text">常见函数：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93"><span class="toc-number">7.2.</span> <span class="toc-text">二次渲染</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89"><span class="toc-number">8.</span> <span class="toc-text">条件竞争</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">8.1.</span> <span class="toc-text">参考资料</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E5%9B%9E%E9%A1%BE"><span class="toc-number">9.</span> <span class="toc-text">总结回顾</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8E%A8%E8%8D%90%E9%98%85%E8%AF%BB"><span class="toc-number">10.</span> <span class="toc-text">推荐阅读</span></a></li></ol></div></div><div class="post-content"><p><a target="_blank" rel="noopener" href="https://github.com/theLSA/upload-labs">upload-labs
靶场</a></p>
<h1 id="预备知识">预备知识</h1>
<h2 id="发现及利用">发现及利用</h2>
<p>会员注册上传功能，扫描工具扫出的上传点，后台管理系统上传功能等。</p>
<h2 id="危害">危害</h2>
<p>攻击者可以通过上传漏洞获取当前网站的权限，webshell 权限。</p>
<h2 id="过滤手段">过滤手段</h2>
<p>文件上传按照对上传文件的后缀名的限制分为：黑名单过滤与白名单过滤。</p>
<h2 id="判断木马是否解析">判断木马是否解析</h2>
<p>如果是一句话的话</p>
<p>找到图片的地址访问它（一般是，右键新标签页打开图片网址），看看网页内容，</p>
<ol type="1">
<li><p>传的只有代码，</p>
<p>如果原原本本地把你的文件内容显示出来那是当做文本解析了，失败。
如果是空白，那就好了，说明当做代码解析了。</p></li>
<li><p>传的是图片马</p>
<p>只要不正常显示图片，显示图片乱码啥的，就可以认为正常解析了。</p></li>
</ol>
<p>当然，我们再用 Cknife 或中国蚁剑去连接试试就行了。</p>
<p>如果是由 Web 图形界面的大马</p>
<p>直接看图形界面显示没有就行了。</p>
<h1 id="前端-javascript-限制">前端 Javascript 限制</h1>
<p>前端 JS 限制上传文件的后缀名，常用绕过方法：</p>
<ol type="1">
<li>浏览器禁用 Javascript</li>
<li>先上传改为图片后缀的代码文件，然后 Burp
代理抓包，改后缀名为对应可解析代码的后缀名。</li>
<li>修改或删减 Javascript 代码</li>
</ol>
<p>注意：区分前端与后端限制：</p>
<ol type="1">
<li><p>后端限制一般为页面回显的文字提示。JS
前端限制一般为弹窗提示（不仅仅局限于文件上传）。</p>
<p>如果什么时候，你看到浏览器弹窗，就要知道这是前端 JS 代码的操作，禁用
JS 或 抓包绕过，这两种方法就要浮现在眼前。此外，如果是前端限制，在
chrome Dev tools 的 Elements 中，Ctrl + F
，便可以搜到提示文字。</p></li>
<li><p>前端限制不需要服务器发包，不会刷新页面。
后端限制要向服务器发包之后，会刷新页面</p></li>
</ol>
<p>实例</p>
<p>upload labs 第一关</p>
<h1 id="后端-mime_types-白名单">后端 MIME_types 白名单</h1>
<p>如果是上传图片的话，就只会允许 image/jpeg、image/gif image/png
等图片相关的 MIME TYPE 上传。</p>
<blockquote>
<p><strong>媒体类型</strong>（通常称为 <strong>Multipurpose Internet
Mail Extensions</strong> 或 <strong>MIME</strong> 类型
）是一种标准，用来表示文档、文件或字节流的性质和格式重要：**浏览器通常使用
MIME 类型（而不是文件扩展名）来确定如何处理 URL，因此 Web
服务器在响应头中添加正确的 MIME
类型非常重要。如果配置不正确，浏览器可能会曲解文件内容，网站将无法正常工作，并且下载的文件也会被错误处理。</p>
</blockquote>
<p>摘自：<a
target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types">MIME
类型</a></p>
<p>它位于 HTTP header 的 <strong>Content</strong>-<strong>Type</strong>
字段。</p>
<p><a
target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Complete_list_of_MIME_types">常见
MIME 类型列表</a></p>
<p>常见的类型：</p>
<ul>
<li><p>jpg 与 jpeg 都是 image/jpeg 类型</p></li>
<li><p>gif 是 image/gif 类型，png 是 image/png 类型。</p></li>
<li><p><code>text/plain</code>
表示文本文件的默认值。一个文本文件应当是人类可读的，并且不包含二进制数据。</p></li>
<li><p><code>application/octet-stream</code>
表示所有其他情况的默认值。一种未知的文件类型应当使用此类型。浏览器在处理这些文件时会特别小心,
试图防止、避免用户的危险行为.</p></li>
</ul>
<p>如何确定后端在某些 HTTP 头上的限制（这里就是：MIME TYPE 限制）</p>
<p>这里讲一个通用的方法，当然，如果只是看 MIME-TYPES
不用这么麻烦，直接看就行啦。</p>
<p>上传正常后缀图片文件，抓包发送到 comparer，同样的上传 php
后缀代码文件，抓包发送到 comparer。二者对比，看看 header
头有哪些不一样的地方。当然，我们这里需要判断 Content-type 字段，那就看
content-type 是否一样，甚至可以去 Repeater 发包验证是不是 MIME-TYPES
限制，如果是的话，我们上传 php 文件，抓包改掉 content-type
就可以了。</p>
<h1 id="后端后缀名黑名单">后端后缀名黑名单</h1>
<p>如果是某些代码后缀名或配置文件后缀名，便禁止上传。</p>
<p>绕过方式：</p>
<h2 id="黑名单不全">黑名单不全</h2>
<p>过滤的后缀名不全</p>
<p>尝试 Web 中间件（Apache，IIS，Nginx
等）其他的可以解析的但是黑名单没有过滤的后缀名。
适用于黑名单不全的情况，要是黑名单比较全，那这个方式就不好使了。</p>
<p>对 Apache 与 PHP 来说（其他的思路大致一样）</p>
<p>Apache PHP
常见的有：php3，php4，php5，php6，phtml，phps，pht，但是要想让 Apache
解析前提是下面将的配置文件中配置了它。</p>
<p>理论基础：</p>
<p>首先在 Apache 和 PHP 以 Module 的<a
target="_blank" rel="noopener" href="https://blog.csdn.net/sinat_22991367/article/details/73431316">方式结合</a>的情况下（我们一个个研压缩包安装的，就是
Module 方式结合，其他的还没了解过 emm），自己配置过环境的都知道，在
Apache 的 conf/httpd.conf 配置文件中，我们需要加载 PHP 的一些模块、配置
PHP 路径，并且需要配置添加 Apache 要把哪些后缀名的文件交给 PHP
解析。</p>
<p>而下面这语句就是</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .php .php3 .phtml</span><br></pre></td></tr></table></figure>
<p>这里面的后缀名就是正常情况下，Apache
可以解析的后缀名，如果黑名单屏蔽不全的话，我们便可以使用其中之一绕过，如果都屏蔽了，那这个方法就凉了。</p>
<p>过滤逻辑有问题</p>
<p>对于有的黑名单过滤，只过滤一次后缀 php
的，可以采用双写文件名绕过，文件名改成<code>xx.pphphp</code></p>
<p>实例：upload lab Pass 10</p>
<h2 id="操作系统特性">操作系统特性</h2>
<p>windows 系统下</p>
<ol type="1">
<li><p>在 Linux 没有特殊配置的情况下，这种情况只有 Windows 可以，因为
Windows 会忽略大小写，因此我们可以尝试大小写绕过。当然，因为 linux
环境下，路径是区分大小写的，在 apache 部署下的 web
应用，有时候出现大小写不匹配导致无法访问。我们也可以配置 apache
支持不区分大小写，这就要通过 speling_module
模块了。这我们知道就好了。</p>
<p>实例：upload labs Pass 5</p></li>
<li><p>Win
下<code>xx.jpg[空格] 或 xx.jpg.</code>这两类文件都是不允许存在的，若这样命名，windows
会默认除去空格或点此处会删除末尾的点，但是没有去掉末尾的空格，因此上传一个<code>.php空格</code>文件即可。需要知道的是，如果黑名单对你的后缀名进行了去点、去空格操作，这种方法就不太好使了。当然，如果他的去除逻辑有问题，我们便可以绕过。</p>
<p>实例：upload lab Pass 6，Pass 7，Pass 9</p></li>
<li><p>NTFS
文件系统包括对备用数据流的支持。这不是众所周知的功能，主要包括提供与
Macintosh
文件系统中的文件的兼容性。备用数据流允许文件包含多个数据流。每个文件至少有一个数据流。在
Windows
中，此默认数据流称为：<code>$DATA</code>。上传<code>.php::$DATA</code>绕过。(仅限
windows)</p></li>
</ol>
<h2 id="重写文件解析规则">重写文件解析规则</h2>
<p>上传中间件的相关配置文件，是自己的文件被对应脚本语言解析。</p>
<p>Apache 当后缀名没有过滤 .htaccess 时，我们可以上传 <a
target="_blank" rel="noopener" href="https://www.jianshu.com/p/81305ca91ebd">.htaccess
文件</a>，通过它来配置我们上传的文件被 PHP 解析。</p>
<p>上传 <code>.htaccess</code>文件需要：httpd.conf 中的</p>
<p>1.<code>mod_rewrite模块开启</code>，这个作用是允许在 httpd.conf
外重写配置</p>
<p>2.<code>AllowOverride All</code>，这个作用是允许重写覆盖相关配置</p>
<p>我们上传的 .htaccess 文件内容：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">FilesMatch</span> &quot;<span class="attr">shell.jpg</span>&quot;&gt;</span></span><br><span class="line">  SetHandler application/x-httpd-php</span><br><span class="line"><span class="tag">&lt;/<span class="name">FilesMatch</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>意思是：匹配文件 shell.jpg，将此名的文件都交给 PHP 解析处理。</p>
<p>这种方法在它会随机改上传文件的名字的情况下，就不好使了（可以看看 Pass
3，就是这样）。一方面文件名改成了由时间名组成的文件名，这样我们的配置文件当然不能生效了。另一方面，在配置文件我们写的是：将
shell.jpg 当做 php 执行，可是，我们的 shell.jpg 也被改名字了。</p>
<p>实例：</p>
<p>upload labs Pass 2 与 Pass 3 分别对应方法一和二。</p>
<h1 id="脚本语言函数特性">脚本语言函数特性</h1>
<p>这里当然是拿 PHP 来举例了。</p>
<p>1.move_uploaded_file`函数的 00 截断漏洞绕过。</p>
<p>PHP 任意文件上传漏洞<a
target="_blank" rel="noopener" href="https://www.cnblogs.com/cyjaysun/p/4390930.html">CVE-2015-2348
浅析</a></p>
<p>对于 GET 方式 传路径</p>
<p>上传的文件名写成<code>hello.jpg</code>, save_path
改成<code>../upload/shell.php%00</code>，最后保存下来的文件就是<code>11.php</code>。</p>
<p><a
target="_blank" rel="noopener" href="http://www.cnblogs.com/cyjaysun/p/4390930.html">CVE-2015-2348</a>影响版本：<code>5.4.x&lt;= 5.4.39, 5.5.x&lt;= 5.5.23, 5.6.x &lt;= 5.6.7</code></p>
<p>对于 POST 方式传路径，由于 POST 方式不会进行 URL 解码，我们需要将%00
进行 URL Decode 或者直接在 hex 处增加 00。</p>
<p>上传文件名的后缀名改为正常的后缀名，.jpg，然后，在/upload/ 后面加个
shell.php+，然后，去 hex 下，将+对应的 2b 改为 00 因为用 post
获取路径，不会像 get 一样自动 url 解码。所以，用 hex 将空格（20）改为 00
或者 %00 再右键 url decode</p>
<p>实例：Upload labs 11</p>
<p>2.利用<code>pathinfo</code>的特性绕过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">pathinfo</span>(<span class="string">&quot;/testweb/shell.php/.&quot;</span>,PATHINFO_EXTENSION));</span><br><span class="line"><span class="keyword">string</span>(<span class="number">0</span>) <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">pathinfo</span>(<span class="string">&#x27;/testweb/shell.php\00.jpg&#x27;</span>,PATHINFO_EXTENSION));</span><br><span class="line"><span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;jpg&quot;</span></span><br></pre></td></tr></table></figure>
<p>在后缀名后面加 <code>/.</code> pathinfo
获取到空的后缀名，从而绕过黑名单。然后 Window 文件后缀名会去掉
<code>/</code>、<code>.</code>及`<code>，因此它就被识别为了 PHP。当然，利用</code>\00<code>绕过，</code>move_uploaded_file<code>会忽略后面的</code>.jpg`</p>
<p>实例：Upload labs Pass 19</p>
<p>3.<code>end</code>与<code>count</code>的函数特性</p>
<p>end()
函数将数组内部指针指向最后一个元素，并返回该元素的值（如果成功）。</p>
<p>count() 函数返回数组中元素的数目.</p>
<p>Pass 20 关键代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ext</span> = <span class="title function_ invoke__">end</span>(<span class="variable">$file</span>);</span><br><span class="line">....</span><br><span class="line"><span class="variable">$file_name</span> = <span class="title function_ invoke__">reset</span>(<span class="variable">$file</span>) . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$file</span>[<span class="title function_ invoke__">count</span>(<span class="variable">$file</span>) - <span class="number">1</span>];</span><br></pre></td></tr></table></figure>
<p><code>end</code>取的是数据的最后一个元素，无论下标（感觉 PHP
的数组有点类似 C 语言数组和结构体的合体，haha），</p>
<p><code>count($arr)-1</code>取的是下标为总个数简易的元素。</p>
<p>reset
函数将数组的指针移到第一个元素，并返回它的值。这里是用来从数组中取文件名字。</p>
<p>举例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="string">&quot;0&quot;</span>=&gt;<span class="string">&quot;jpg&quot;</span>, <span class="string">&quot;2&quot;</span>=&gt;<span class="string">&quot;php&quot;</span>, <span class="string">&quot;1&quot;</span>=&gt;<span class="string">&quot;jpg&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">end</span>(<span class="variable">$arr</span>));</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$arr</span>[<span class="title function_ invoke__">count</span>(<span class="variable">$arr</span>) - <span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;jpg&quot;</span></span><br><span class="line"><span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;php&quot;</span></span><br></pre></td></tr></table></figure>
<p>我们创建了一个数组，数组顺序不是按照寻常的顺序的，我们故意把最后一个元素排在了前面一位，这样<code>end</code>就取到了<code>jpg</code>后缀，这样我们就可以利用<code>$_POST[save_name]</code>来绕过最后后缀检测了</p>
<p>数组绕过，利用 end 取数组最后一个元素，而代码是取索引的最后一个。
判断时，判断最后指针的位置 save_name[2] 也就是 jpg，于是绕过后缀名检查。
拼接文件名时，使用数组的第一个指针位置即：<code>shell.php/</code>作为文件名，
使用下标为 [元素个数-1]，即：索引为 1
的数组中的值作为扩展名，我们这里没有写，因此为空。</p>
<p>之后使用
<code>$file_name = reset($file) . '.' . $file[count($file) - 1];</code>拼接文件名就是
<code>shell.php/</code>。但是你知道 . 在 windows 中是
<code>/.</code>会被去除的。因此，我们上传的文件名为：只需要访问：../upload/shell.php
就可以了</p>
<h1 id="中间件解析漏洞">中间件解析漏洞</h1>
<p>Apache 解析漏洞从右向左判断后缀名，从而判断能否解析。</p>
<p>Apache
解析文件的规则是从右到左开始判断解析,如果后缀名为不可识别文件解析,就再往左判断。比如
test.php.owf.rar “.owf”和”.rar” 这两种后缀是 apache 不可识别解析，apache
就会把 wooyun.php.owf.rar 解析成 php。</p>
<p>修复方法：要在配置文件里面修改，写解析漏洞的时候再详细讲吧。</p>
<p>实例：upload lab Pass 19</p>
<h1 id="图片马">图片马</h1>
<p>很多时候，我们没有别的办法了，这时候就只能是图片马加上文件包含漏洞了。</p>
<p>上传图片马，然后确定图片与文件包含的代码文件的相对路径，在文件包含的参数中写上图片马的相对路径及名称，然后使用蚁剑连接即可。</p>
<p>图片马的制作：</p>
<ol type="1">
<li><p>命令行</p>
<ol type="1">
<li><p>echo php 代码 &gt;&gt; xx.jpg</p></li>
<li><p>copy 方法 copy baidu.png /b + shell.php /a
baidu_shell.png</p></li>
</ol></li>
<li><p>用记事本或 Notepad++ 或者 UltraEdit
打开图片，在最后粘贴代码即可。</p></li>
</ol>
<p>像 upload labs Pass 13 要求的那样，我们电脑上一般都备好 jpg，png，gif
三种图片马，用的时候直接拿来用就好了。</p>
<p>注意：有些网上的图片做图片马不会成功，最好找一些免费没版权的图片来整。如果你的图片马解析不了，不妨多换个七八张个图片试试
emm。（这也是为什么让你以后备好图片马的原因，感觉好像是图片问题，不是所有的图片做成图片马之后，都会被正常解析。）</p>
<h2 id="常见函数">常见函数：</h2>
<p>unpack() 函数从二进制字符串对数据进行解包，常用来检测文件头。</p>
<p>可以通过添加图片的头部标识绕过，比如：添加 GIF
图片的文件头<code>GIF89a</code>，绕过 GIF 图片检查。</p>
<p>getimagesize()
函数用于获取图像大小及相关信息，成功返回一个数组，失败则返回 FALSE
并产生一条 E_WARNING 级的错误信息。返回值为数组，数组的索引 2
给出的是图像的类型，返回的是数字，每个数字对应一种图片类型。</p>
<p>stripos()
函数查找字符串在另一字符串中第一次出现的位置（不区分大小写）。</p>
<p>exif_imagetype —
判断一个图像的类型，<strong>exif_imagetype()</strong>
读取一个图像的第一个字节并检查其签名。</p>
<p>upload Pass 13 检测文件头，Pass 14 检测文件类型，Pass 15
exif_imagetype
检测通过检测图像的第一个字节并检查签名来判断图像类型。</p>
<h2 id="二次渲染">二次渲染</h2>
<p>优先使用 gif，其次，jpg，最后 png。</p>
<p>对 gif 的二次渲染来说，我们上传 gif 图片，然后下载，按 16
进制查看下载的图片与原上传的区别，确定渲染处理部分。将一句话插入到未被渲染处理的部分，然后上传即可。</p>
<p>对于 jpg 以及 png 的处理，可以看<a
target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2657#toc-12">upload-labs 之 pass 16
详细分析</a>，感觉好像二者相比，jpg
更为简单，直接运行大佬的脚本就行了。</p>
<p>实例：</p>
<p>Upload labs Pass 16</p>
<p>这里不详细搞了，遇到再说吧。</p>
<h1 id="条件竞争">条件竞争</h1>
<p>条件竞争漏洞是一大类逻辑漏洞，不仅仅限于文件上传，也常见于转账等交易场景。</p>
<p>从 Pass-17 来看，代码是先移动文件到 upload
文件夹，然后判断后缀是否在名单中，再删除与否，我们可以通过一定的时间差来访问自己上传的文件导致写入
shell 的。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;shell.php&quot;</span>,<span class="string">&quot;&lt;?php phpinfo();?&gt;&quot;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里我们的代码就要稍微改一下，我们改成写文件的代码。这样只要我们访问到一次，我们就生成了
shell.php 的一句话，然后再去连接爽歪歪。</p>
<p>条件竞争常使用：Burp Suite、Fiddle 等抓包工具，或者自己编写 Python
脚本来测试</p>
<p>使用 Burp intruder 模块，开启两个
Attack，一个不断上传，一个不断访问上传的文件（当然，你要预先能推测出上传后你的文件名以及位置。）。中间我们需要设置线程数（将访问线程开的比上传的线程打大一些，比如：25:5）以及设置
Payload Type 为 nullpayload，然后设置 Payload
Option（设置激发多少次，或者一直攻击），一般我都设置成一直攻击。先发起
post 上传 attack，再发起 get 访问 attack。然后根据 get
的返回长度及返回数据包，我们发现访问成功以后，便去访问创建的
shell.php，查看它是否解析成功，然后用工具去连接。</p>
<h2 id="参考资料">参考资料</h2>
<p>来两个简单的，深层次到操作系统的，咱也看不懂，咱也看不下去呀。</p>
<p>实例：Pass 17，Pass 18</p>
<p><a
target="_blank" rel="noopener" href="https://v0w.top/2018/08/16/%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89/">条件竞争</a></p>
<p><a
target="_blank" rel="noopener" href="https://co0ontty.github.io/2019/04/12/batterupload.html">结合 CTF
详解条件竞争漏洞</a></p>
<p><a
target="_blank" rel="noopener" href="https://mengsec.com/2018/04/07/Race-Condition/">条件竞争（Race
Condition）</a></p>
<h1 id="总结回顾">总结回顾</h1>
<ol type="1">
<li>要接着学，从 Apache 与 PHP 要衍生到别的组合</li>
<li>熟悉了解中间件的配置文件以及一些关键配置。</li>
<li>自己搭建环境。复现相关解析漏洞。</li>
</ol>
<h1 id="推荐阅读">推荐阅读</h1>
<p><a
target="_blank" rel="noopener" href="https://klionsec.github.io/2017/11/13/ntfs-streams/">文件隐藏 之
NTFS 交换数据流</a></p>
<p><a
target="_blank" rel="noopener" href="https://blog.csdn.net/vivilorne/article/details/3841509">谈谈 NTFS
数据流文件</a></p>
<p><a target="_blank" rel="noopener" href="https://gh0st.cn/archives/2017-03-29/1">文件寄生——NTFS
文件流实际应用</a></p>
<p><a
target="_blank" rel="noopener" href="https://thief.one/2016/09/21/%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E/">服务器解析漏洞</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/4029#toc-7">Upload-labs 20
关通关笔记</a></p>
<p><a
target="_blank" rel="noopener" href="https://www.smi1e.top/%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/">文件解析漏洞总结</a></p>
<p><a
target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/164561#h3-7">对文件上传的一些思考和总结</a></p>
<p><a
target="_blank" rel="noopener" href="https://paper.seebug.org/560/#2-filename">简单粗暴的文件上传漏洞</a></p>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/blog/2019/08/30/programming/python/py_multithreading/">Python多线程基础</a><a class="next" href="/blog/2019/08/20/programming/php/php-mysql-apache-war/">WAMP 安装配置以及 war 包导入 Tomcat</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/" title=""><img class="nofancybox" src="/blog/img/avatar.png"/></a><p>What keeps me alive is my love for people and life and my desire to explore the unknown</p><a class="info-icon" href="mailto:findrealyee@outlook.com" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/realyee/" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/Cryptography/">Cryptography</a><span class="category-list-count">29</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/Cryptography/math/">math</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/Cryptography/zero-knowledge-proof/">zero-knowledge proof</a><span class="category-list-count">20</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/Golang/">Golang</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/academic/">academic</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/blockchain/">blockchain</a><span class="category-list-count">25</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/cplusplus/">cplusplus</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/go/">go</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/linux/">linux</a><span class="category-list-count">34</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/linux/git/">git</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/linux/macos/">macos</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/linux/tools/">tools</a><span class="category-list-count">12</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/misc/">misc</a><span class="category-list-count">16</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/misc/latex/">latex</a><span class="category-list-count">5</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/ml/">ml</a><span class="category-list-count">27</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/ml/rl/">rl</a><span class="category-list-count">4</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/network/">network</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/os/">os</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/php/">php</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/probabilities/">probabilities</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/python/">python</a><span class="category-list-count">64</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/security-miscellaneous/">security miscellaneous</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/shell/">shell</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/utilities/">utilities</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/websec/">websec</a><span class="category-list-count">35</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/websec/cmd-execution/">cmd_execution</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/websec/file-upload/">file_upload</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/websec/logic-vuln/">logic_vuln</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/websec/sql-injection/">sql injection</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/websec/xss/">xss</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/wireshark/">wireshark</a><span class="category-list-count">7</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/blog/tags/academic/" style="font-size: 15px;">academic</a> <a href="/blog/tags/sci/" style="font-size: 15px;">sci</a> <a href="/blog/tags/jcr/" style="font-size: 15px;">jcr</a> <a href="/blog/tags/ml/" style="font-size: 15px;">ml</a> <a href="/blog/tags/cuda/" style="font-size: 15px;">cuda</a> <a href="/blog/tags/misc/" style="font-size: 15px;">misc</a> <a href="/blog/tags/vscode/" style="font-size: 15px;">vscode</a> <a href="/blog/tags/threat-intelligence/" style="font-size: 15px;">threat intelligence</a> <a href="/blog/tags/typing/" style="font-size: 15px;">typing</a> <a href="/blog/tags/distance/" style="font-size: 15px;">distance</a> <a href="/blog/tags/osi-sec/" style="font-size: 15px;">osi_sec</a> <a href="/blog/tags/smtp/" style="font-size: 15px;">smtp</a> <a href="/blog/tags/mail/" style="font-size: 15px;">mail</a> <a href="/blog/tags/Boot/" style="font-size: 15px;">Boot</a> <a href="/blog/tags/Computer/" style="font-size: 15px;">Computer</a> <a href="/blog/tags/FAT/" style="font-size: 15px;">FAT</a> <a href="/blog/tags/FDT/" style="font-size: 15px;">FDT</a> <a href="/blog/tags/os/" style="font-size: 15px;">os</a> <a href="/blog/tags/efi/" style="font-size: 15px;">efi</a> <a href="/blog/tags/Python/" style="font-size: 15px;">Python</a> <a href="/blog/tags/Tools/" style="font-size: 15px;">Tools</a> <a href="/blog/tags/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" style="font-size: 15px;">网络协议</a> <a href="/blog/tags/Wireshark%E5%8A%9F%E8%83%BD/" style="font-size: 15px;">Wireshark功能</a> <a href="/blog/tags/%E6%B8%97%E9%80%8F/" style="font-size: 15px;">渗透</a> <a href="/blog/tags/%E6%8A%93%E5%8C%85/" style="font-size: 15px;">抓包</a> <a href="/blog/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 15px;">计算机网络</a> <a href="/blog/tags/zkp/" style="font-size: 15px;">zkp</a> <a href="/blog/tags/circom/" style="font-size: 15px;">circom</a> <a href="/blog/tags/git/" style="font-size: 15px;">git</a> <a href="/blog/tags/ssh/" style="font-size: 15px;">ssh</a> <a href="/blog/tags/arch/" style="font-size: 15px;">arch</a> <a href="/blog/tags/manjaro/" style="font-size: 15px;">manjaro</a> <a href="/blog/tags/chmod/" style="font-size: 15px;">chmod</a> <a href="/blog/tags/ping/" style="font-size: 15px;">ping</a> <a href="/blog/tags/network/" style="font-size: 15px;">network</a> <a href="/blog/tags/find/" style="font-size: 15px;">find</a> <a href="/blog/tags/head/" style="font-size: 15px;">head</a> <a href="/blog/tags/tail/" style="font-size: 15px;">tail</a> <a href="/blog/tags/ioredirect/" style="font-size: 15px;">ioredirect</a> <a href="/blog/tags/pipe/" style="font-size: 15px;">pipe</a> <a href="/blog/tags/fd/" style="font-size: 15px;">fd</a> <a href="/blog/tags/iproute2/" style="font-size: 15px;">iproute2</a> <a href="/blog/tags/kill/" style="font-size: 15px;">kill</a> <a href="/blog/tags/hardlink/" style="font-size: 15px;">hardlink</a> <a href="/blog/tags/softlink/" style="font-size: 15px;">softlink</a> <a href="/blog/tags/netstat/" style="font-size: 15px;">netstat</a> <a href="/blog/tags/ss/" style="font-size: 15px;">ss</a> <a href="/blog/tags/lsof/" style="font-size: 15px;">lsof</a> <a href="/blog/tags/traceroute/" style="font-size: 15px;">traceroute</a> <a href="/blog/tags/vim/" style="font-size: 15px;">vim</a> <a href="/blog/tags/latex/" style="font-size: 15px;">latex</a> <a href="/blog/tags/CNN/" style="font-size: 15px;">CNN</a> <a href="/blog/tags/convolution/" style="font-size: 15px;">convolution</a> <a href="/blog/tags/CMake/" style="font-size: 15px;">CMake</a> <a href="/blog/tags/Make/" style="font-size: 15px;">Make</a> <a href="/blog/tags/php/" style="font-size: 15px;">php</a> <a href="/blog/tags/python/" style="font-size: 15px;">python</a> <a href="/blog/tags/re/" style="font-size: 15px;">re</a> <a href="/blog/tags/Regexp/" style="font-size: 15px;">Regexp</a> <a href="/blog/tags/shell/" style="font-size: 15px;">shell</a> <a href="/blog/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/blog/tags/pseudo-static/" style="font-size: 15px;">pseudo static</a> <a href="/blog/tags/sql-injection/" style="font-size: 15px;">sql injection</a> <a href="/blog/tags/XSS/" style="font-size: 15px;">XSS</a> <a href="/blog/tags/collection/" style="font-size: 15px;">collection</a> <a href="/blog/tags/collections/" style="font-size: 15px;">collections</a> <a href="/blog/tags/comprehensions/" style="font-size: 15px;">comprehensions</a> <a href="/blog/tags/fun/" style="font-size: 15px;">fun</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/blog/2023/09/18/ml/wasserstein_dist/">Delve into Wasserstein Distance, principles and implementation analysis</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2023/09/17/math/probabilities/wasserstein_bg/">Probabilities background for Wasserstein Distance</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2023/08/11/academic/papers/ldp_location/">L-SRR Local Differential Privacy for Location-Based Services with Staircase Randomized Response</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2023/08/10/academic/papers/ldp_byz_fl/">Practical Differentially Private and Byzantine-resilient Federated Learning</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2023/08/04/academic/papers/fedrecover/">FedRecover 论文阅读笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2023/08/04/academic/papers/flcert/">FLCert Provably Secure Federated Learning against Poisoning Attacks 论文阅读笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2023/08/04/academic/papers/fltrust/">FLTrust Byzantine-robust Federated Learning via Trust Bootstrapping 论文阅读笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2023/05/30/crypto/zk/specific2program/">zk with programmability</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2023/04/30/crypto/zk/great_resource/">zk 资料汇总</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2023/04/16/misc/latex/latex_grammars/">常用 LaTeX 语法总结</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="https://snowolf0620.xyz/" title="snowolf0620" target="_blank">snowolf0620</a><ul></ul><a href="https://space.keter.top/" title="Sonder" target="_blank">Sonder</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2024 <a href="/blog/." rel="nofollow">realyee's blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/blog/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/blog/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/blog/css/search.css?v=1.0.0"><script type="text/javascript" src="/blog/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/blog/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/blog/js/copycode.js?v=1.0.0" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/blog/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/blog/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/blog/js/smartresize.js?v=1.0.0"></script></div></body></html>